---
layout: post
title:  "Modern XP: Making Time To Tend Code"
date:   2015-04-30 
---

Our codebases can be considered to be like a garden that continues to be fruitful with appropriate investment of time and care. Like gardeners, developers need to tend their codebases. Plants don’t stay the same shape, as time passes they grow in all directions and eventually die back making room for others. Code grows in different directions over time too, sometimes we need to get rid of code that yields little business value. To walk easily around your garden, you have to cut back stray branches to keep paths clear. We need time to prune sprawling code, thin out overcrowded components and tease out new services so they may flourish. 

In my experience Scrum-style planning tends to focus a team on developing user stories that can easily be explained to non-technical stakeholders. Extending the gardening metaphor, the items that appear in our backlogs are like new garden features -- plant a fruit tree so we have apples, install a shed so we can keep our tools safe, create a stunning herbaceous border in the front so we can make our neighbours envious, etc. Sprint planning doesn't cover time for weeding the existing flower beds, raking up dead leaves, removing an ants nest that’s making the patio unusable. Developers need time to stay on top of technical maintenance alongside development of new features. A Scrum team should be able to add technical tasks to their backlog but typically the focus of a sprint is meeting the sprint goal, delivering new features that will generate value. 

Developers often grumble that there's not enough stay on top of the technical tasks. I’m talking about things that no stakeholder will ask for. ADD A FEW EXAMPLES OF GREEN CARDS HERE. Such tasks can be deferred over delivering more features but the longer we neglect these type of tasks the more work we will need to do to sort them out. Anyone who has ever had a lawn knows grass grows fast in the spring -- you need to get out with your mower every week or you'll soon regret it. Leave the grass until it's knee high, you have to use a strimmer. Strimming long grass takes a lot longer than mowing and leaves the grass looking roughly hacked back. Putting off care for your lawn turns a simple task into a laborious one. 

![Strimming](http://rachelcdavies.github.io/images/strimming.jpg)

In order to set aside more time, some teams try to make significant technical work visible to their business stakeholders by creating technical stories. For example, we recently created a technical story to cover a rewrite of a stats pipeline to handle higher volumes of data. However, there's just so much mundane stuff that it doesn't make sense to expose a stream of bitty technical stories to stakeholders unless it's going impact our delivery of new features. Where we have technical tasks jostling for time alongside work on new features, all lumped together in a single burndown and bundled into velocity together, it's really hard for any team to get the balance between these types of work right.

Inspired by the Kanban concept separating out different Classes of Service for feature development over support changes, I've encouraged our XP teams at [Unruly](http://tech.unruly.co) to separate out different kinds of work on their team boards. This enables the teams to balance their capacity across different types of work (features, tech tasks, support, research). Doing this helps use maintain momentum on all of these different things. This sounds a bit complicated but making different kinds of work visual helps us not to neglect one kind of work over another.

Teams use different colour cards for the different kinds of work. Appropriately we use green cards for code tending work. Radically, we don't include work done on green cards in our team velocity. Our velocity only represents our likely capacity work on stories. How do we get time to do green cards? We just do them, our velocity drops. We use the lower velocity to plan as usual. Now we always have time to attend to a steady stream of code tending tasks. Our business stakeholders are happy with this because we keep delivering new features and they don’t have to wrestle with trying to understand the priority of technical stuff we need to do to maintain our codebase.

![Green Cards on the Board](http://rachelcdavies.github.io/images/OldTabascoBoard.jpg)

All of our teams use simple tracking mechanisms to ensure that we maintain a balance between new features and technical improvement. One team does[dot counting](http://rachelcdavies.github.io/2014/03/03/dot-counting.html). Two of our other teams keep an area on their whiteboard for tracking where their time goes. They have their own system of coloured magnets and hieroglyphs.  
These are updated at standup and we take photos of the board to reviewed in our team retrospectives.

We don’t defer refactoring to be done later as green cards. When we add new features to our codebase, we improve design as we go. It’s just that sometimes we stumble across a big wasps nest in the code that needs serious work to fix. Going back to gardening metaphors, we clean up the garden as we add new features to it. Installing a pond does include removing the earth leftover after digging the hole for the water to go in. But if we discover a patch of brambles or an infestation of honey fungus in the process of adding a new feature we.

![Green Card Prioritisation](http://rachelcdavies.github.io/images/GreenCardPrioritisation.jpg)

Each team prioritises their green cards weekly. We ask ourselves will doing this work help us deliver value to our business. Or as Bruce likes to put it “does this make our days closer to ideal days”. This means that we don’t pick technical tasks on parts of the system that are likely to be cut later.

There are times when we are tempted to deliver more customer facing features, our velocity goes up and then we commit to more stories next time. But often our system will force us to put on the brakes. Neglecting technical tasks will slow us down, our tests take longer to run, it takes more time to deploy, developer motivation is sapped. We may even lose developers who are fed up with working around an ageing technology stack.

Setting aside time to tend our code is essential for us to maintain fruitful software assets. Start by making these technical tasks visible to your team. Prioritise these tasks so that you work on the ones that will yield most value. At standup make code tending tasks part of your team's work. Keep track how much time you spend on code tending as this can help you get the right balance against business facing features. Reflect together as a team so you keep on top of code tending.

You may wonder whether putting prioritisation of tech tasks in the hands of developers will lead to business priorities being ignored. We prefer to consider that our developers are taking on more responsibility and accountability. We also find this way of working helps developers keep their code bases pleasant and easy to work in.